require('dotenv').config();
const { Telegraf, Markup } = require('telegraf');

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±Ð¾Ñ‚Ð° Ñ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð¼ Ð¸Ð· .env
const bot = new Telegraf(process.env.TELEGRAM_BOT_TOKEN);

// ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /start
bot.start(async (ctx) => {
    const userName = ctx.from.first_name || 'ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ';
    
    const welcomeText = `
ðŸŒŸ *Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Vertex, ${userName}!* ðŸŒŸ

*Vertex* â€” ÑÑ‚Ð¾ Ð½Ð°Ð´ÐµÐ¶Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¾Ð±Ð¼ÐµÐ½Ð° *USDT Ð½Ð° Ñ€ÑƒÐ±Ð»Ð¸* Ñ Ð»ÑƒÑ‡ÑˆÐ¸Ð¼ ÐºÑƒÑ€ÑÐ¾Ð¼ Ð½Ð° Ñ€Ñ‹Ð½ÐºÐµ!

ðŸš€ *ÐšÐ°Ðº Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ:*
1. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐžÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°ÑÐ²ÐºÑƒ"
2. Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ñ„Ð¾Ñ€Ð¼Ñƒ Ð½Ð° Ð½Ð°ÑˆÐµÐ¼ ÑÐ°Ð¹Ñ‚Ðµ
3. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ñ€ÐµÐºÐ²Ð¸Ð·Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð°
4. Ð¡Ð¾Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ðµ Ð¾Ð±Ð¼ÐµÐ½ Ð·Ð° 5-15 Ð¼Ð¸Ð½ÑƒÑ‚!

*ÐÐ°ÑˆÐ¸ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ð¸:*
âœ… Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ ÑÐ´ÐµÐ»Ð¾Ðº
âœ… ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´
âœ… ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° 24/7
    `;
    
    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ñ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÐµÐ¼
    const keyboard = Markup.inlineKeyboard([
        [
            Markup.button.webApp(
                'ðŸ“ ÐžÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°ÑÐ²ÐºÑƒ',
                `${process.env.SITE_URL}/order` // Ð’Ð°Ñˆ ÑÐ°Ð¹Ñ‚
            )
        ]
    ]);
    
    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹
    await ctx.replyWithMarkdown(welcomeText, keyboard);
    
    // Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    console.log(`ðŸ‘¤ ÐÐ¾Ð²Ñ‹Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: ${userName} (ID: ${ctx.from.id})`);
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch()
    .then(() => console.log('ðŸ¤– Vertex Bot (Telegraf) Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!'))
    .catch((err) => console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°:', err));

// Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ graceful shutdown
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));